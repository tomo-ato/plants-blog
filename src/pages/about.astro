---
import { parseScrapboxContent } from '../utils/scrapbox-parser';
import Layout from '../layouts/Layout.astro';

const PROJECT_NAME = 'tomohirotsuji-plants';

const [listRes, pageRes] = await Promise.all([
  fetch(`https://scrapbox.io/api/pages/${PROJECT_NAME}`),
  fetch(`https://scrapbox.io/api/pages/${PROJECT_NAME}/Tomo_at`),
]);
const listData = await listRes.json();
const pageData = await pageRes.json();

const titleToId = Object.fromEntries(listData.pages.map((p) => [p.title, p.id]));
const titleToImage = Object.fromEntries(
  listData.pages.filter((p) => p.image).map((p) => [p.title, p.image])
);

const parsedContent = pageData.lines
  ? parseScrapboxContent(pageData.lines.slice(1), titleToId, titleToImage)
  : [];
---

<Layout title="About Me - Tomo at plants.">
  <nav class="breadcrumb">
    <a href="/">TOP</a>
    <span class="sep">â€º</span>
    <span class="current">About Me</span>
  </nav>
  <h1>{pageData.title || 'About Me'}</h1>
  <div class="content">
    {parsedContent.map((item) => (
      <Fragment set:html={item.html} />
    ))}
  </div>
</Layout>
