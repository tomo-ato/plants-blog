---
import Layout from '../layouts/Layout.astro';
import { getCategory, TILLANDSIA_PARENTS } from '../utils/categories';

const PROJECT_NAME = 'tomohirotsuji-plants';
const response = await fetch(`https://scrapbox.io/api/pages/${PROJECT_NAME}`);
const data = await response.json();

const PLANT_GENERA = new Set(['tillandsia', 'oxalis', 'lepanthes', 'avonia', 'article']);
const PARENT_TITLES = new Set(TILLANDSIA_PARENTS.map((p) => p.title));
const pages = data.pages.filter((p) =>
  PLANT_GENERA.has(getCategory(p.title).genus) && !PARENT_TITLES.has(p.title)
);
---

<Layout title="Tomo at plants.">
  <h1>Tomo at plants.</h1>
  <ul class="page-list">
    {pages.map((page) => (
      <li class="page-item">
        <a href={`/page/${page.id}`}>{page.title}</a>
        <div class="page-meta">
          更新日: {new Date(page.updated * 1000).toLocaleDateString('ja-JP')}
        </div>
      </li>
    ))}
  </ul>
</Layout>

<style>
  .page-list {
    list-style: none;
    padding: 0;
  }
  .page-item {
    margin: 20px 0;
    padding: 15px;
    border: 1px solid #ddd;
    border-radius: 5px;
  }
  .page-item a {
    text-decoration: none;
    color: #0066cc;
    font-size: 1.2em;
    font-weight: bold;
  }
  .page-meta {
    color: #666;
    font-size: 0.9em;
    margin-top: 5px;
  }
</style>
