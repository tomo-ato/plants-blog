---
import Layout from '../../layouts/Layout.astro';
---

<Layout title="タグ検索 - Tomo at plants.">
  <a href="/" class="back-link">← 一覧に戻る</a>
  <h1 id="tag-heading">タグ検索</h1>
  <div id="status">読み込み中...</div>
  <ul class="page-list" id="page-list"></ul>

  <script>
    async function main() {
      const params = new URLSearchParams(location.search);
      const tag = params.get('q') || '';
      if (!tag) {
        document.getElementById('status').textContent = 'タグが指定されていません';
        return;
      }

      document.title = `${tag} - Tomo at plants.`;
      document.getElementById('tag-heading').innerHTML =
        `<span class="tag-label">${tag}</span> のページ一覧`;

      try {
        const res = await fetch('/tag-index.json');
        if (!res.ok) {
          document.getElementById('status').textContent =
            'タグインデックスが見つかりません。npm run sync-tags を実行してください';
          return;
        }
        const tagIndex = await res.json();
        const pages = tagIndex[tag] || [];

        const status = document.getElementById('status');
        const list = document.getElementById('page-list');

        if (pages.length === 0) {
          status.textContent = '該当するページが見つかりませんでした';
          return;
        }

        status.textContent = `${pages.length}件のページが見つかりました`;
        list.innerHTML = pages
          .map((p) => `<li><a href="/page/${p.id}">${p.title}</a></li>`)
          .join('');
      } catch {
        document.getElementById('status').textContent = '読み込みに失敗しました';
      }
    }

    main();
  </script>
</Layout>

<style>
  .tag-label {
    display: inline-block;
    background: #f5f5f5;
    color: #666;
    padding: 4px 12px;
    border-radius: 4px;
    font-size: 1.1em;
  }
  .page-list {
    list-style: none;
    padding: 0;
    margin-top: 20px;
  }
  .page-list li {
    border-bottom: 1px solid #eee;
    padding: 12px 0;
  }
  .page-list a {
    color: #0066cc;
    text-decoration: none;
    font-size: 1.05em;
  }
  .page-list a:hover {
    text-decoration: underline;
  }
  #status {
    color: #666;
    margin-top: 20px;
  }
</style>
